---
# defaults file for ./roles/ssh

ssh_package_dependencies:
  - openssh-server

# ------------------------------------------------------------------------------
ssh_directory: /etc/ssh
ssh_directory_home: ~/.ssh

# ------------------------------------------------------------------------------
ssh_short_moduli: 3071
ssh_service_enabled: yes # start on boot

# ------------------------------------------------------------------------------
# ------------------------------------------------------------------------------
# ------------------------------------------------------------------------------
# template sshd_config.config.j2
ssh_port: 22
ssh_use_PAM: "yes"
ssh_use_dns: "no"
ssh_accept_env: "LANG LC_*"
ssh_print_motd: "no"
# ssh_authentication_methods: publickey
# ssh_use_privilege_separation: sandbox

ssh_host_keys:
  - /etc/ssh/ssh_host_rsa_key
  # - /etc/ssh/ssh_host_ecdsa_key
  - /etc/ssh/ssh_host_ed25519_key
# HINT: if ssh_host_keys is set also define to recreate the files to make them more secure
ssh_host_keys_func:
  - rm /etc/ssh/ssh_host_*
  - ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ""
  - ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N ""

ssh_ciphers:
  - chacha20-poly1305@openssh.com
  - aes256-gcm@openssh.com
  - aes128-gcm@openssh.com
  - aes256-ctr
  - aes192-ctr
  - aes128-ctr

ssh_kex_algorithms:
  - curve25519-sha256
  - curve25519-sha256@libssh.org
  - diffie-hellman-group16-sha512
  - diffie-hellman-group18-sha512
  - diffie-hellman-group-exchange-sha256

ssh_macs:
  - hmac-sha2-256-etm@openssh.com
  - hmac-sha2-512-etm@openssh.com
  - umac-128-etm@openssh.com

ssh_log_level: VERBOSE

# possible values: prohibit-password, yes, no
# note: this must be string not bool, so you need to quote 'yes' and 'no'
ssh_permit_root_login: "no"
ssh_strict_modes: yes
ssh_pubkey_authentication: yes
ssh_pubkey_accepted_key_types:
  - ssh-ed25519
ssh_password_authentication: no
ssh_permit_empty_password: no
ssh_challenge_response_authentication: no # yes?
ssh_gssapi_authentication: no
ssh_gssapi_cleanup_credentials: yes
ssh_agent_forwarding: yes
ssh_tcp_forwarding: yes
ssh_x11_forwarding: no # yes?

ssh_banner:
  src: path/to/local/ssh-banner
  dest: /etc/ssh/banner

ssh_subsystems:
  - name: sftp
    command: /usr/lib/ssh/sftp-server -f AUTHPRIV -l INFO

# ------------------------------------------------------------------------------
# template config.config.j2 (installed per user in ~/.ssh)
ssh_hash_known_hosts: yes
ssh_host_key_algorithms:
  - ssh-ed25519
  - ssh-ed25519-cert-v01@openssh.com
  - sk-ssh-ed25519@openssh.com
  - sk-ssh-ed25519-cert-v01@openssh.com
  - rsa-sha2-256
  - rsa-sha2-256-cert-v01@openssh.com
  - rsa-sha2-512
  - rsa-sha2-512-cert-v01@openssh.com

ssh_user_kex_algorithms: "{{ ssh_kex_algorithms }}"
ssh_user_macs: "{{ ssh_macs }}"
ssh_user_ciphers: "{{ ssh_ciphers }}"

# ------------------------------------------------------------------------------
# ------------------------------------------------------------------------------
# ------------------------------------------------------------------------------
# template jail.local.j2
jail_bantime: 3600
jail_banaction: iptables-multiport
jail_enabled: true
jail_maxretry: 3
